---
title: "Create maps using jpndistrict"
author: "Shinya Uryu"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  fig.argin = "center",
  warning = FALSE,
  message = FALSE
)
```

パッケージと都道府県の県庁所在地のデータを読み込みます。

```{r}
library(magrittr)
library(dplyr)
library(spdplyr)
library(jpndistrict)
data("jpnprefs")
```

```{r, eval = TRUE}
spdf.33 <- spdf_jpn_cities(jis_code_pref = 33, jis_code = c(33101, 33102, 33103, 33104, 33205))
```

## ggplot2

```{r gg_jpn_district_pref33_capital_point}
library(ggplot2)
d33 <- jpnprefs %>% filter(prefecture == "岡山県") %>% 
               rename(lat = capital_latitude,
                      long = capital_longitude) %>% 
  mutate(id = 33101)

p <- spdf.33 %>% fortify(.) %>% gg_jpn_district()
p + geom_point(data = d33, aes(x = long, y = lat, fill = "#2196F3", size = 6)) +
  guides(fill = FALSE, size = FALSE)
```

```{r gg_jpn_district_pref37}
spdf_jpn_pref(code = "37", district = TRUE) %>% gg_jpn_district()
```

```{r gg_jpn_district_pref_feature_ggghost}
p <- spdf_jpn_cities(jis_code_pref = 33, jis_code = c(33103)) %>% gg_jpn_district()
p - ggthemes::theme_map()
```

## leaflet

```{r}
library(leaflet)
leaflet() %>%
  addTiles() %>%
  addPolylines(data = spdf.33, color = "red")
```

## plotly (test)

```{r}
library(plotly)

g <- list(
  scope = "asia",
  showland = TRUE,
  landcolor = toRGB("grey83"),
  subunitcolor = toRGB("white"),
  countrycolor = toRGB("white"),
  showlakes = TRUE,
  lakecolor = toRGB("white"),
  showsubunits = TRUE,
  showcountries = TRUE,
  resolution = 50,
  projection = list(
    type = "conic conformal",
    rotation = list(lon = 130)
  ),
  lonaxis = list(
    showgrid = TRUE,
    gridwidth = 0.5,
    range = c(min(jpnprefs$capital_longitude) - 3, max(jpnprefs$capital_longitude) + 3),
    dtick = 5
  ),
  lataxis = list(
    showgrid = TRUE,
    gridwidth = 0.5,
    range = c(min(jpnprefs$capital_latitude) - 5, max(jpnprefs$capital_latitude) + 5),
    dtick = 5
  )
)

plot_geo(jpnprefs, lat = ~capital_latitude, lon = ~capital_longitude) %>%
  add_markers() %>%
  layout(geo = g)
```
